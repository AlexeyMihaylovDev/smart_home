# Серверная часть для хранения настроек

## Описание

Все настройки и кэш теперь сохраняются на сервере, что позволяет синхронизировать данные между разными браузерами и устройствами.

## Установка

1. Установите зависимости:
```bash
npm install
```

2. Запустите приложение (сервер и клиент одновременно):
```bash
npm run dev
```

Или запустите отдельно:
```bash
# Терминал 1 - Сервер настроек
npm run dev:server

# Терминал 2 - Клиент (Vite)
npm run dev:client
```

## Структура

- `server/index.js` - Express сервер для хранения настроек
- `server/data/` - Папка для хранения данных (создается автоматически)
- `src/services/apiService.ts` - Клиентский API для работы с сервером

## API Endpoints

### GET /api/config/widget
Получить конфигурацию виджетов

### POST /api/config/widget
Сохранить конфигурацию виджетов

### GET /api/config/layout
Получить layout дашборда

### POST /api/config/layout
Сохранить layout дашборда

### GET /api/config/connection
Получить настройки подключения к Home Assistant

### POST /api/config/connection
Сохранить настройки подключения к Home Assistant

### GET /api/health
Проверка здоровья сервера

## Fallback на localStorage

Если сервер недоступен, приложение автоматически использует localStorage как резервный вариант. Это обеспечивает работу даже при недоступности сервера.

## Миграция данных

При первом запуске сервера данные будут загружены из localStorage (если они там есть) и сохранены на сервере. После этого все изменения будут синхронизироваться с сервером.

## Порт

Сервер настроек работает на порту **3001** по умолчанию.

## Безопасность

⚠️ **Важно**: Токен Home Assistant хранится на сервере в открытом виде в файле `server/data/connection.json`. Убедитесь, что:
- Папка `server/data/` не доступна через веб-сервер
- Файлы с настройками имеют правильные права доступа
- Сервер настроек доступен только в вашей локальной сети

